if(!E)var E={map:function(c,l){var g={};return l?c.map(function(b,p){return g.index=p,l.call(g,b)}):c.slice()},naturalOrder:function(c,l){return c<l?-1:c>l?1:0},sum:function(c,l){var g={};return c.reduce(l?function(b,p,r){return g.index=r,b+l.call(g,p)}:function(b,p){return b+p},0)},max:function(c,l){return Math.max.apply(null,l?E.map(c,l):c)}};var D=function(){function c(r,t,o){return(r<<10)+(t<<5)+o}function l(r){var t=[],o=!1;function u(){t.sort(r),o=!0}return{push:function(e){t.push(e),o=!1},peek:function(e){return o||u(),e===void 0&&(e=t.length-1),t[e]},pop:function(){return o||u(),t.pop()},size:function(){return t.length},map:function(e){return t.map(e)},debug:function(){return o||u(),t}}}function g(r,t,o,u,e,n,f){var a=this;a.r1=r,a.r2=t,a.g1=o,a.g2=u,a.b1=e,a.b2=n,a.histo=f}function b(){this.vboxes=new l(function(r,t){return E.naturalOrder(r.vbox.count()*r.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function p(r,t){if(t.count()){var o=t.r2-t.r1+1,u=t.g2-t.g1+1,e=E.max([o,u,t.b2-t.b1+1]);if(t.count()==1)return[t.copy()];var n,f,a,s,v=0,h=[],m=[];if(e==o)for(n=t.r1;n<=t.r2;n++){for(s=0,f=t.g1;f<=t.g2;f++)for(a=t.b1;a<=t.b2;a++)s+=r[c(n,f,a)]||0;h[n]=v+=s}else if(e==u)for(n=t.g1;n<=t.g2;n++){for(s=0,f=t.r1;f<=t.r2;f++)for(a=t.b1;a<=t.b2;a++)s+=r[c(f,n,a)]||0;h[n]=v+=s}else for(n=t.b1;n<=t.b2;n++){for(s=0,f=t.r1;f<=t.r2;f++)for(a=t.g1;a<=t.g2;a++)s+=r[c(f,a,n)]||0;h[n]=v+=s}return h.forEach(function(d,w){m[w]=v-d}),function(d){var w,C,x,M,y,z=d+"1",_=d+"2",I=0;for(n=t[z];n<=t[_];n++)if(h[n]>v/2){for(x=t.copy(),M=t.copy(),y=(w=n-t[z])<=(C=t[_]-n)?Math.min(t[_]-1,~~(n+C/2)):Math.max(t[z],~~(n-1-w/2));!h[y];)y++;for(I=m[y];!I&&h[y-1];)I=m[--y];return x[_]=y,M[z]=x[_]+1,[x,M]}}(e==o?"r":e==u?"g":"b")}}return g.prototype={volume:function(r){var t=this;return t._volume&&!r||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(r){var t=this,o=t.histo;if(!t._count_set||r){var u,e,n,f=0;for(u=t.r1;u<=t.r2;u++)for(e=t.g1;e<=t.g2;e++)for(n=t.b1;n<=t.b2;n++)f+=o[c(u,e,n)]||0;t._count=f,t._count_set=!0}return t._count},copy:function(){var r=this;return new g(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(r){var t=this,o=t.histo;if(!t._avg||r){var u,e,n,f,a=0,s=0,v=0,h=0;for(e=t.r1;e<=t.r2;e++)for(n=t.g1;n<=t.g2;n++)for(f=t.b1;f<=t.b2;f++)a+=u=o[c(e,n,f)]||0,s+=u*(e+.5)*8,v+=u*(n+.5)*8,h+=u*(f+.5)*8;t._avg=a?[~~(s/a),~~(v/a),~~(h/a)]:[~~(8*(t.r1+t.r2+1)/2),~~(8*(t.g1+t.g2+1)/2),~~(8*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(r){var t=this,o=r[0]>>3;return gval=r[1]>>3,bval=r[2]>>3,o>=t.r1&&o<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},b.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var t=this.vboxes,o=0;o<t.size();o++)if(t.peek(o).vbox.contains(r))return t.peek(o).color;return this.nearest(r)},nearest:function(r){for(var t,o,u,e=this.vboxes,n=0;n<e.size();n++)((o=Math.sqrt(Math.pow(r[0]-e.peek(n).color[0],2)+Math.pow(r[1]-e.peek(n).color[1],2)+Math.pow(r[2]-e.peek(n).color[2],2)))<t||t===void 0)&&(t=o,u=e.peek(n).color);return u},forcebw:function(){var r=this.vboxes;r.sort(function(e,n){return E.naturalOrder(E.sum(e.color),E.sum(n.color))});var t=r[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(r[0].color=[0,0,0]);var o=r.length-1,u=r[o].color;u[0]>251&&u[1]>251&&u[2]>251&&(r[o].color=[255,255,255])}},{quantize:function(r,t){if(!r.length||t<2||t>256)return!1;var o=function(s){var v,h=new Array(32768);return s.forEach(function(m){v=c(m[0]>>3,m[1]>>3,m[2]>>3),h[v]=(h[v]||0)+1}),h}(r);o.forEach(function(){});var u=function(s,v){var h,m,d,w=1e6,C=0,x=1e6,M=0,y=1e6,z=0;return s.forEach(function(_){(h=_[0]>>3)<w?w=h:h>C&&(C=h),(m=_[1]>>3)<x?x=m:m>M&&(M=m),(d=_[2]>>3)<y?y=d:d>z&&(z=d)}),new g(w,C,x,M,y,z,v)}(r,o),e=new l(function(s,v){return E.naturalOrder(s.count(),v.count())});function n(s,v){for(var h,m=s.size(),d=0;d<1e3;){if(m>=v||d++>1e3)return;if((h=s.pop()).count()){var w=p(o,h),C=w[0],x=w[1];if(!C)return;s.push(C),x&&(s.push(x),m++)}else s.push(h),d++}}e.push(u),n(e,.75*t);for(var f=new l(function(s,v){return E.naturalOrder(s.count()*s.volume(),v.count()*v.volume())});e.size();)f.push(e.pop());n(f,t);for(var a=new b;f.size();)a.push(f.pop());return a}}}().quantize,k=function(c){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=c.naturalWidth,this.height=this.canvas.height=c.naturalHeight,this.context.drawImage(c,0,0,this.width,this.height)};k.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var q=function(){};q.prototype.getColor=function(c,l){return l===void 0&&(l=10),this.getPalette(c,5,l)[0]},q.prototype.getPalette=function(c,l,g){var b=function(o){var u=o.colorCount,e=o.quality;if(u!==void 0&&Number.isInteger(u)){if(u===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");u=Math.max(u,2),u=Math.min(u,20)}else u=10;return(e===void 0||!Number.isInteger(e)||e<1)&&(e=10),{colorCount:u,quality:e}}({colorCount:l,quality:g}),p=new k(c),r=function(o,u,e){for(var n,f,a,s,v,h=o,m=[],d=0;d<u;d+=e)f=h[0+(n=4*d)],a=h[n+1],s=h[n+2],((v=h[n+3])===void 0||v>=125)&&(f>250&&a>250&&s>250||m.push([f,a,s]));return m}(p.getImageData().data,p.width*p.height,b.quality),t=D(r,b.colorCount);return t?t.palette():null},q.prototype.getColorFromUrl=function(c,l,g){var b=this,p=document.createElement("img");p.addEventListener("load",function(){var r=b.getPalette(p,5,g);l(r[0],c)}),p.src=c},q.prototype.getImageData=function(c,l){var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(){if(this.status==200){var b=new Uint8Array(this.response);i=b.length;for(var p=new Array(i),r=0;r<b.length;r++)p[r]=String.fromCharCode(b[r]);var t=p.join(""),o=window.btoa(t);l("data:image/png;base64,"+o)}},g.send()},q.prototype.getColorAsync=function(c,l,g){var b=this;this.getImageData(c,function(p){var r=document.createElement("img");r.addEventListener("load",function(){var t=b.getPalette(r,5,g);l(t[0],this)}),r.src=p})};export{q as default};
